import{h as T}from"./moment-Cl4UOzQZ.js";import{m as E,P as L,D as Y}from"./DeleteModal-BsDt2vWB.js";import{_ as D,o as i,b as c,e,t as o,n as p,s as k,x as A,F as f,u as C,h as O,f as w,p as N,g as B,i as H,j as _,a as $,m as q,y as R,d as y,r as P,q as U}from"./index-DszfTdZn.js";import{l as I,u as F}from"./alert-B-4weYjB.js";const j={mixins:[E],props:["tempOrder"],emits:["update-order"],data(){return{modal:"",tab:"content"}},methods:{formatTime(t){return T(t).format("YYYY/MM/DD HH:mm:ss")}}},n=t=>(N("data-v-79014413"),t=t(),B(),t),z={class:"modal modal-lg fade",tabindex:"-1",ref:"modal"},G={class:"modal-dialog modal-dialog-centered"},J={class:"modal-content"},K={class:"modal-header"},Q={class:"fs-5 mb-0"},W=n(()=>e("i",{class:"bi bi-x-circle-fill"},null,-1)),X=[W],Z={class:"modal-body py-4"},ee={class:"nav nav-pills bg-light rounded-2 mb-3"},te={class:"nav-item flex-grow-1"},se={class:"nav-item flex-grow-1"},re={class:"table table-light"},oe={class:"text-end"},le={class:"fs-5 fw-bold"},de=n(()=>e("td",{colspan:"2"},"總計",-1)),ne={class:"text-end"},ae={class:"mb-0"},ie=n(()=>e("span",null,"付款狀態：",-1)),ce=n(()=>e("span",{class:"badge bg-primary me-2"},"訂單成立日期",-1)),me=n(()=>e("hr",null,null,-1)),ue=n(()=>e("span",{class:"badge bg-primary me-2"},"姓名",-1)),pe=n(()=>e("hr",null,null,-1)),he=n(()=>e("span",{class:"badge bg-primary me-2"},"電話",-1)),_e=n(()=>e("hr",null,null,-1)),be=n(()=>e("p",null,[e("span",{class:"badge bg-primary"},"地址")],-1)),ge=n(()=>e("hr",null,null,-1)),fe=n(()=>e("p",null,[e("span",{class:"badge bg-primary"},"信箱")],-1)),Oe=n(()=>e("hr",null,null,-1)),ve=n(()=>e("p",null,[e("span",{class:"badge bg-primary"},"留言")],-1)),ye={class:"pre-wrap mb-0"},Pe={key:0,class:"modal-footer"};function ke(t,s,r,V,l,h){return i(),c("div",z,[e("div",G,[e("div",J,[e("div",K,[e("h4",Q,o(r.tempOrder.id),1),e("button",{type:"button",class:"btn border-0 p-0 fs-4",onClick:s[0]||(s[0]=(...a)=>t.hideModal&&t.hideModal(...a))},X)]),e("div",Z,[e("ul",ee,[e("li",te,[e("button",{type:"button",onClick:s[1]||(s[1]=a=>l.tab="content"),class:p(["w-100 nav-link",{active:l.tab==="content"}])}," 訂購商品",2)]),e("li",se,[e("button",{type:"button",onClick:s[2]||(s[2]=a=>l.tab="info"),class:p(["w-100 nav-link",{active:l.tab==="info"}])}," 客戶資訊",2)])]),k(e("div",null,[e("table",re,[e("tbody",null,[(i(!0),c(f,null,C(r.tempOrder.products,(a,v)=>(i(),c("tr",{key:v},[e("td",null,o(a.product.title),1),e("td",null,"× "+o(a.qty)+" "+o(a.product.unit),1),e("td",oe,"NT$ "+o(a.total),1)]))),128))]),e("tfoot",le,[e("tr",null,[de,e("td",ne,"NT$ "+o(r.tempOrder.total),1)])])]),e("p",ae,[ie,e("span",{class:p(r.tempOrder.is_paid?"text-success":"text-danger")},o(r.tempOrder.is_paid?"已付款":"未付款"),3)])],512),[[A,l.tab==="content"]]),k(e("div",null,[e("p",null,[ce,O(" "+o(h.formatTime(r.tempOrder.create_at*1e3)),1)]),me,e("p",null,[ue,O(" "+o(r.tempOrder.user.name),1)]),pe,e("p",null,[he,O(" "+o(r.tempOrder.user.tel),1)]),_e,be,e("p",null,o(r.tempOrder.user.address),1),ge,fe,e("p",null,o(r.tempOrder.user.email),1),Oe,ve,e("p",ye,o(r.tempOrder.message),1)],512),[[A,l.tab==="info"]])]),r.tempOrder.is_paid?w("",!0):(i(),c("div",Pe,[e("button",{type:"button",class:"btn btn-highlight",onClick:s[3]||(s[3]=a=>t.$emit("update-order"))}," 確認結單")]))])])],512)}const we=D(j,[["render",ke],["__scopeId","data-v-79014413"]]);var Me={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/q-vue-warn-side-effect",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const m=I(),u=F(),{VITE_APP_SITE:b,VITE_APP_PATH:g}=Me,S=H("adminOrder",{state:()=>({orders:[],currentPage:1}),getters:{totalPages:({orders:t})=>Math.ceil(t.length/5)},actions:{switchPage(t){this.currentPage=t},getOrders(){m.createLoader("getOrders"),_.get(`${b}/api/${g}/admin/orders`).then(t=>{this.orders=t.data.orders,this.switchPage(1)}).catch(t=>u.errorAlert(t)).finally(()=>m.removeLoader("getOrders"))},updateOrder(t,s){m.createLoader("updateOrder"),_.put(`${b}/api/${g}/admin/order/${t.id}`,{data:{...t,is_paid:!t.is_paid}}).then(r=>{u.toastAlert(r.data.message,"success"),s(),this.getOrders()}).catch(r=>u.errorAlert(r)).finally(()=>m.removeLoader("updateOrder"))},deleteOrder(t,s){m.createLoader("deleteOrder"),_.delete(`${b}/api/${g}/admin/order/${t}`).then(()=>{u.toastAlert("我們懷念它 (´;ω;`)","success"),s(),this.getOrders()}).catch(r=>u.errorAlert(r)).finally(()=>m.removeLoader("deleteOrder"))},deleteAllOrders(){u.multiverseAlert(this.downTheDrain)},downTheDrain(){m.createLoader("deleteAllOrders"),_.delete(`${b}/api/${g}/admin/orders/all`).then(()=>{u.toastAlert("沒了 ... 都沒了 (´;ω;`)","success"),this.getOrders()}).catch(t=>u.errorAlert(t)).finally(()=>m.removeLoader("deleteAllOrders"))}}}),Ae={components:{PaginationComponent:L,AdminOrderModal:we,DeleteModal:Y},data(){return{tempOrder:{user:{},products:{}},deletePermission:!1}},computed:{...$(S,["orders","currentPage","totalPages"]),...$(I,["loadingItem"])},methods:{...q(S,["getOrders","switchPage","updateOrder","deleteOrder","deleteAllOrders"]),formatTime(t){return T(t).format("YYYY/MM/DD")},openModal(t){this.tempOrder={...t},this.$refs.orderModal.showModal()}},mounted(){this.getOrders()}},$e={class:"text-end mb-5"},Se=e("h3",{class:"fs-2 mb-3"},"訂單管理",-1),Te={class:"fs-6 text-muted"},De={class:"alert bg-light flex-classic mb-5"},Ce={class:"d-flex gap-2"},Ie={for:"unlock",class:"btn btn-outline-primary"},Ve={class:"table table-hover"},xe=e("thead",null,[e("tr",null,[e("th",{width:"10%"},"成立日期"),e("th",{width:"50%"},"詳細"),e("th",{width:"30%",class:"text-end"}," 總額"),e("th",{width:"10%",class:"text-center"},"處理")])],-1),Ee=["onClick"],Le={class:"me-2"},Ye=e("i",{class:"bi bi-search"},null,-1),Ne={class:"text-end"},Be={class:"text-center"},He=["disabled"],qe={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Re={key:1,class:"alert bg-light"};function Ue(t,s,r,V,l,h){const a=P("pagination-component"),v=P("admin-order-modal"),x=P("delete-modal");return i(),c(f,null,[e("div",$e,[Se,e("p",Te,[e("span",null,"目前共有 "+o(t.orders.length)+" 筆訂單，",1),e("span",null,"尚有 "+o(t.orders.filter(d=>!d.is_paid).length)+" 筆未結單",1)])]),t.orders.length?(i(),c(f,{key:0},[e("div",De,[e("div",Ce,[k(e("input",{type:"checkbox",id:"unlock",class:"btn-check","onUpdate:modelValue":s[0]||(s[0]=d=>l.deletePermission=d)},null,512),[[R,l.deletePermission]]),e("label",Ie,[e("i",{class:p(["bi",l.deletePermission?"bi-unlock-fill":"bi-lock-fill"])},null,2)]),l.deletePermission?(i(),c("button",{key:0,type:"button",class:"btn btn-danger",onClick:s[1]||(s[1]=(...d)=>t.deleteAllOrders&&t.deleteAllOrders(...d))},"刪除所有訂單")):w("",!0)]),y(a,{current:t.currentPage,total:t.totalPages,onSwitchPage:t.switchPage},null,8,["current","total","onSwitchPage"])]),e("table",Ve,[xe,e("tbody",null,[(i(!0),c(f,null,C(t.orders,d=>(i(),c("tr",{key:d.id,class:"align-middle"},[e("td",null,o(h.formatTime(d.create_at*1e3)),1),e("td",null,[e("span",{class:p(["badge me-3",d.is_paid?"bg-success":"bg-danger"])},o(d.is_paid?"已付款":"未付款"),3),e("a",{href:"#",onClick:U(M=>h.openModal(d),["prevent"])},[e("span",Le,o(d.user.name),1),Ye],8,Ee)]),e("td",Ne,"NT$ "+o(d.total),1),e("td",Be,[e("button",{type:"button",class:"btn btn-outline-danger",disabled:!l.deletePermission,onClick:s[2]||(s[2]=(...M)=>t.$refs.deleteModal.showModal&&t.$refs.deleteModal.showModal(...M))},[t.loadingItem===d.id?(i(),c("span",qe)):w("",!0),O(" 刪除")],8,He)])]))),128))])])],64)):(i(),c("div",Re,"還沒有任何訂單～")),y(v,{ref:"orderModal","temp-order":l.tempOrder,onUpdateOrder:s[3]||(s[3]=d=>t.updateOrder(l.tempOrder,t.$refs.orderModal.hideModal))},null,8,["temp-order"]),y(x,{ref:"deleteModal",target:l.tempOrder,"target-genre":"order",onDeleteTarget:s[4]||(s[4]=d=>t.deleteOrder(l.tempOrder.id,t.$refs.deleteModal.hideModal))},null,8,["target"])],64)}const Je=D(Ae,[["render",Ue]]);export{Je as default};
